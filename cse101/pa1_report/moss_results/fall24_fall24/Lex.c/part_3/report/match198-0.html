<html>
<head>
<title>/fall24/asvay/pa1/Lex.c</title>
</head>
<body bgcolor="white">
<hr/>
/fall24/asvay/pa1/Lex.c<p></p><pre>
// Lex.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include "List.h"

// Defining main function
<a name="0"></a><font color="#FF0000"><a href="match198-1.html#0" target="1"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_0_18.gif"/></a>

int main(int argc, char *argv[]) {
    if (argc != 3) {
        fprintf(stderr, "Usage: Lex &lt;input file&gt; &lt;output file&gt;\n");
        exit(EXIT_FAILURE);
    }

    char *inputFile = argv[1];
    char *outputFile = argv[2];

    FILE *in = fopen(inputFile, "r");
    if (in == NULL) {
        fprintf(stderr, "Unable to open file %s\n", inputFile);
        exit(EXIT_FAILURE);
    }

    // Counting lines and allocating memory for string array
    int n = 0;
</font>    char **lines = NULL;
    size_t size = 0;

    while (1) {
        if ((int)size == n) {
            size = (size == 0) ? 1 : size * 2;
            lines = realloc(lines, size * sizeof(char *));
            if (lines == NULL) {
                fprintf(stderr, "Memory reallocation failed\n");
                exit(EXIT_FAILURE);
            }
        }
        lines[n] = malloc(256 * sizeof(char));
        if (lines[n] == NULL) {
            fprintf(stderr, "Memory allocation failed for line %d\n", n);
            exit(EXIT_FAILURE);
        }
        if (fgets(lines[n], 256, in) == NULL) break;
        n++;
    }

    fclose(in);

    // Creating list of indices
    List indexList = newList();

    for (int i = 0; i &lt; n; i++) {
        // Insert the index i into the List in sorted order
        moveFront(indexList); // Start at the front of the List
        
        while (getIndex(indexList) &gt;= 0) {
            int currentIndex = get(indexList); // Get the current index in the List

            // Ensure both lines are valid before comparing
            if (lines[i] == NULL || lines[currentIndex] == NULL) {
                fprintf(stderr, "Null pointer in lines array at index %d or %d\n", i, currentIndex);
                exit(EXIT_FAILURE);
            }

            // Compare the current line with the new line
            int cmpResult = strcmp(lines[i], lines[currentIndex]);
            if (cmpResult &lt; 0) {
                // If lines[i] comes before lines[currentIndex], insert i before currentIndex
                insertBefore(indexList, i);
                break;
            }
            moveNext(indexList); // Move to the next index in the List
        }

        // If we reached the end of the List without inserting, append to the back
        if (getIndex(indexList) == -1) {
            append(indexList, i);
        }
    }

    // Writing to the output file
    FILE *out = fopen(outputFile, "w");
    if (out == NULL) {
        fprintf(stderr, "Unable to open file %s\n", outputFile);
        exit(EXIT_FAILURE);
    }

    moveFront(indexList); // Move cursor to the front of the List
    while (getIndex(indexList) &gt;= 0) {
        int idx = get(indexList); // Get the index
        if (idx &gt;= 0 &amp;&amp; idx &lt; n) {
            fprintf(out, "%s", lines[idx]); // Write the corresponding line to the output file
        } else {
            fprintf(stderr, "Invalid index %d while writing to output file\n", idx);
        }
        moveNext(indexList); // Move to the next index
    }
    fclose(out);

    // Cleaning up
    for (int i = 0; i &lt; n; i++) {
        free(lines[i]);
    }
    free(lines);
    freeList(&amp;indexList);
	// DOone 
    return 0;
}

</pre>
</body>
</html>
