<html>
<head>
<title>/fall24/esbajwa/pa1/Lex.c</title>
</head>
<body bgcolor="white">
<hr/>
/fall24/esbajwa/pa1/Lex.c<p></p><pre>
/****************************************************************************************
*  Name: Eshan Bajwa
*  ID: 2069964
*  Assignment: pa1
*****************************************************************************************
*  Lex.c
*  Writes the lines from the infile to the outfile in lexographical order
*  Uses the List ADT for sorting
*****************************************************************************************/

#include "List.h"

#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;assert.h&gt;
#include &lt;stdlib.h&gt;

<a name="0"></a><font color="#FF0000"><a href="match79-0.html#0" target="0"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_0_66.gif"/></a>

char **array_from_file(char* filename, int *len_ptr) {
	FILE* fp = fopen(filename, "r");

	// find the number of lines in the file
	int num_lines = 0;
	while(fscanf(fp, "%*[^\n]") != EOF) { // scan for anything that's not a \n
		fgetc(fp); // read the newline so we can start at the right spot next time
		num_lines ++;
	}

	char **string_arr = calloc(sizeof(char *), num_lines); // declare outer array
	fseek(fp, 0, SEEK_SET); // return to start of file

	for(int i = 0;; i++) { // populate the array
		long start = ftell(fp);
		if (fscanf(fp, "%*[^\n]") == EOF) break;
		long len = ftell(fp) - start + 1; // +1 since length starts at 1

		string_arr[i] = calloc(sizeof(char), len+1);

		// go back to the start of this line and read it into the arr
		// since we now know how long the line is
		fseek(fp, start, SEEK_SET);
		fgets(string_arr[i], len, fp); // includes the newline

		string_arr[i][len] = '\0'; // set the null term after the newline
		assert(fgetc(fp) == '\n'); // read past the newline, for the next iter
	}

	*len_ptr = num_lines;
	fclose(fp);
	return string_arr;
}

int main(int argc, char* argv[]) {
	if (argc != 3) {
		fprintf(stderr, "USAGE: Lex &lt;input_file&gt; &lt;output_file&gt;\n");
		return -1;
	}

	int num_lines;
	char **inputArr = array_from_file(argv[1], &amp;num_lines);

	List L = newList();
	append(L, 0);
	for(int i = 1; i &lt; num_lines; i++) {
		moveFront(L);

		// move forward until we hit a larger element or the end of the list
		while(index(L) &gt;= 0 &amp;&amp; strcmp(inputArr[get(L)], inputArr[i]) &lt; 0) {
</font><a name="1"></a><font color="#00FF00"><a href="match79-0.html#1" target="0"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_1_25.gif"/></a>

			moveNext(L);
		}

		if (index(L) == -1) { // we reached the end
			append(L, i);
		} else { // we reached something bigger/same size
			insertBefore(L, i);
		}
	}

	FILE* fp = fopen(argv[2], "w");

	moveFront(L);
	for(int i = 0; i &lt; length(L); i++) {
		fprintf(fp, "%s\n", inputArr[get(L)]);
		moveNext(L);
	}

	fclose(fp);
	
	// cleanup cleanup everybody cleanup
	for(int i = 0; i &lt; num_lines; i++) {
		free(inputArr[i]);
</font>	}
	free(inputArr);
	freeList(&amp;L);

	return 0;
}
</pre>
</body>
</html>
