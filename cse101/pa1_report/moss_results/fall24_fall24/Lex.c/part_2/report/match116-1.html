<html>
<head>
<title>/fall24/psathian/pa1/Lex.c</title>
</head>
<body bgcolor="white">
<hr/>
/fall24/psathian/pa1/Lex.c<p></p><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include "List.h"
#include &lt;string.h&gt;
#define MAX_LINE_LENGTH 1024

int main(int argc, char* argv[]){
    if (argc != 3) {
        fprintf(stderr, "Usage: %s input_file output_file\n", argv[0]);
        return 1;
    }

    FILE* inFile = fopen(argv[1], "r");
    if (inFile == NULL) {
        fprintf(stderr, "Error: could not open input file %s\n", argv[1]);
        return 1;
    }

<a name="0"></a><font color="#FF0000"><a href="match116-0.html#0" target="0"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_0_58.gif"/></a>

    FILE* outFile = fopen(argv[2], "w");
    if (outFile == NULL) {
        fprintf(stderr, "Error: could not open output file %s\n", argv[2]);
        fclose(inFile);
        return 1;
    }

    int count = 0;
    char buffer[MAX_LINE_LENGTH];
    while(fgets(buffer, MAX_LINE_LENGTH, inFile) != NULL) {
        count++;
    }

    // Allocate memory for the array of strings
    char **lines = (char **)malloc(count * sizeof(char *));
    if (lines == NULL) {
        fprintf(stderr, "Error: could not allocate memory for lines array\n");
        fclose(inFile);
        fclose(outFile);
        return 1;
    }

    rewind(inFile);
    int i = 0;
    while(fgets(buffer, MAX_LINE_LENGTH, inFile) != NULL &amp;&amp; i &lt; count) {
        // Remove newline character if present
        buffer[strcspn(buffer, "\n")] = '\0';

        // Allocate memory for each line and copy it to the array
        lines[i] = (char *)malloc(strlen(buffer) + 1); // +1 for null terminator
        if (lines[i] == NULL) {
            fprintf(stderr, "Error: could not allocate memory for line %d\n", i);
            // Free already allocated memory and return
            for (int j = 0; j &lt; i; j++) {
                free(lines[j]);
            }
            free(lines);
            fclose(inFile);
            fclose(outFile);
            return 1;
        }
        strcpy(lines[i], buffer); 
        i++;
    }

    fclose(inFile); // Close the input file as we have read all lines

    // Insertion sort code start

    List L = newList(); // Start with an empty List

    for (int i = 0; i &lt; count; i++) {
        moveFront(L);
        while (index(L) &gt;= 0 &amp;&amp; strcmp(lines[i], lines[get(L)]) &gt; 0) {
</font>            moveNext(L);
        }
        if (index(L) &gt;= 0) {
            insertBefore(L, i);
        } else {
            append(L, i);
        }
    }

    // Insertion sort code end

    // Write the sorted lines to the output file

    moveFront(L);
    while (index(L) &gt;= 0){
        fprintf(outFile, "%s\n", lines[get(L)]); 
        moveNext(L);
    }

    // Free memory
    for (int i = 0; i &lt; count; i++) {
        free(lines[i]); // Free each string
    }
    free(lines);        // Free the array of strings
    freeList(&amp;L);

    fclose(outFile);

    return 0;
}
</pre>
</body>
</html>
