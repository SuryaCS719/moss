<html>
<head>
<title>/fall24/caetcole/pa1/Lex.c</title>
</head>
<body bgcolor="white">
<hr/>
/fall24/caetcole/pa1/Lex.c<p></p><pre>
#include "List.h"

#include &lt;stdbool.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

//Max for buffer later
#define MAX_LINE_LENGTH 1024

<a name="0"></a><font color="#FF0000"><a href="match24-1.html#0" target="1"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_0_98.gif"/></a>

int main(int argc, char **argv){

    //Check args for exactly 3 (start, input, output)
    if(argc != 3){
        fprintf(stderr, "Lex.c Error: Incorrect number of arguments!");
        exit(1);
    }

    char *infilename = argv[1];
    char *outfilename = argv[2];

    FILE* infile = fopen(infilename, "r");
    FILE* outfile = fopen(outfilename, "w");

    //Make sure the file exists
    if(infile == NULL){
        fprintf(stderr, "Lex.c Error: Incorrect input file name!");
        exit(1);
    }

    //Count number of lines
    int lines = 0;
    char buffer[MAX_LINE_LENGTH];

    while (fgets(buffer, MAX_LINE_LENGTH, infile) != NULL) {
        lines++;
    }

    //Reset the file pointer to the beginning for later reading
    rewind(infile);

    if (lines == 0) {
        fclose(infile);
        return 0;
    }
    
    //Allocate memory for the array of strings using calloc
    char **lines_array = (char **)calloc(lines, sizeof(char *));
    if (lines_array == NULL) {
        fprintf(stderr, "Lex.c Error: Memory allocation failed for the array of lines!\n");
        fclose(infile);
        exit(1);
    }

    char buff [MAX_LINE_LENGTH];
    for (int i = 0; i &lt; lines; i++) {
        if (fgets(buff, MAX_LINE_LENGTH, infile) != NULL) {
            // Allocate memory for each line and copy the line from buffer
            lines_array[i] = (char *)calloc(strlen(buff) + 1, sizeof(char));
            if (lines_array[i] == NULL) {
                fprintf(stderr, "Lex.c Error: Memory allocation for line %d failed!\n", i);
                fclose(infile);
                exit(1);
            }
            buff[strcspn(buff, "\n")] = 0;
            strcpy(lines_array[i], buff);
        }
    }

    List sort = newList();
    append(sort, 0);
    
    for(int current = 1; current &lt; lines; current++){
        bool placed = false;
        moveFront(sort);
        while( index(sort)&gt;=0 ){
            if(strcmp(lines_array[get(sort)], lines_array[current]) &gt; 0){ 
                insertBefore(sort, current);
                placed = true;
                break;
            }
            moveNext(sort);
        }
        if(!placed){
            append(sort, current);
        }
    }

    //Free memory and print
    moveFront(sort); 
    for (int i = 0; i&lt;lines; i++){
        fprintf(outfile, "%s\n", lines_array[get(sort)]);
        moveNext(sort);
    }

    for (int i = 0; i &lt; lines; i++) {
        free(lines_array[i]); 
        moveNext(sort);
    }

    //Free everything else
    free(lines_array);
    freeList(&amp;sort);
    fclose(infile);
    fclose(outfile);
</font>    


    return 0;
}
</pre>
</body>
</html>
