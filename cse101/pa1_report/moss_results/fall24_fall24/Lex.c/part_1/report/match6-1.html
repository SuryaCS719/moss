<html>
<head>
<title>/fall24/saarai/pa1/Lex.c</title>
</head>
<body bgcolor="white">
<hr/>
/fall24/saarai/pa1/Lex.c<p></p><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include "List.h"

#define MAX_LINE_LENGTH 1000

<a name="1"></a><font color="#00FF00"><a href="match6-0.html#1" target="0"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_1_19.gif"/></a>

void free_strings(char** strings, int num_lines) {
    if (strings) {
        for (int i = 0; i &lt; num_lines; i++) {
            free(strings[i]);
        }
        free(strings);
    }
}

char* string_duplicate(const char* str) {
    size_t len = strlen(str) + 1;  // +1 for null terminator
    char* new_str = malloc(len);
    if (new_str) {
        memcpy(new_str, str, len);
    }
    return new_str;
}

int main(int argc, char* argv[]) {   
    if (argc != 3) {
        fprintf(stderr, "Usage: %s &lt;input file&gt; &lt;output file&gt;\n", argv[0]);
</font>        return 1;
    }

    FILE *in = fopen(argv[1], "r");
    if (in == NULL) {
        fprintf(stderr, "Cannot open input file '%s'\n", argv[1]);
        return 1;
    }

<a name="0"></a><font color="#FF0000"><a href="match6-0.html#0" target="0"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_0_69.gif"/></a>

    FILE *out = fopen(argv[2], "w");
    if (out == NULL) {
        fprintf(stderr, "Cannot open output file '%s'\n", argv[2]);
        fclose(in);
        return 1;
    }

    char** strings = NULL;
    int num_lines = 0;
    int capacity = 10;
    char buffer[MAX_LINE_LENGTH];

    strings = malloc(capacity * sizeof(char*));
    if (strings == NULL) {
        fprintf(stderr, "Initial memory allocation failed\n");
        fclose(in);
        fclose(out);
        return 1;
    }

    // Read strings from input file
    while (fgets(buffer, sizeof(buffer), in) != NULL) {
        if (num_lines &gt;= capacity) {
            capacity *= 2;
            char** temp = realloc(strings, capacity * sizeof(char*));
            if (temp == NULL) {
                fprintf(stderr, "Memory reallocation failed\n");
                free_strings(strings, num_lines);
                fclose(in);
                fclose(out);
                return 1;
            }
            strings = temp;
        }

        // Remove newline character
        size_t len = strlen(buffer);
        if (len &gt; 0 &amp;&amp; buffer[len-1] == '\n') {
            buffer[len-1] = '\0';
        }

        strings[num_lines] = string_duplicate(buffer);
        if (strings[num_lines] == NULL) {
            fprintf(stderr, "Memory allocation failed for line %d\n", num_lines);
            free_strings(strings, num_lines);
            fclose(in);
            fclose(out);
            return 1;
        }
        num_lines++;
    }

    fclose(in);

    // Create and populate the List
    List L = newList();
    if (L == NULL) {
        fprintf(stderr, "Failed to create new List\n");
        free_strings(strings, num_lines);
        fclose(out);
        return 1;
    }

    // Insertion sort using List
    for (int i = 0; i &lt; num_lines; i++) {
        moveFront(L);
        while (index(L) &gt;= 0 &amp;&amp; strcmp(strings[i], strings[get(L)]) &gt; 0) {
            moveNext(L);
        }
        if (index(L) &gt;= 0) {
            insertBefore(L, i);
        } else {
            append(L, i);
        }
    }

    // Write sorted strings to output file
    moveFront(L);
    while (index(L) &gt;= 0) {
        int idx = get(L);
        if (idx &gt;= 0 &amp;&amp; idx &lt; num_lines) {
            fprintf(out, "%s\n", strings[idx]);
        }
        moveNext(L);
    }

    // Clean up
    fclose(out);
    free_strings(strings, num_lines);
    freeList(&amp;L);
</font>
    return 0;
}</pre>
</body>
</html>
